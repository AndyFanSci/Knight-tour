<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>é¨å£«å·¡ç¦®</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    #intro {
      max-width: 600px;
      line-height: 1.6;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    #controls, #board, #message {
      display: none;
    }
    button, select {
      margin: 0 5px;
      padding: 5px 10px;
      font-size: 14px;
    }
    #board {
      display: grid;
      gap: 4px;
      margin-bottom: 20px;
    }
    .cell {
      width: 60px;
      height: 60px;
      background: white;
      border: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
    }
    .cell.visited {
      background: #90ee90;
      cursor: default;
    }
    .cell.available {
      background: #add8e6;
    }
    .cell.last-move {
      background: #ff6961 !important;
    }
    #message {
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>é¨å£«å·¡ç¦®</h1>

  <div id="intro">
    <h2>ğŸ® éŠæˆ²è¦å‰‡ä»‹ç´¹</h2>
    <p><strong>éŠæˆ²ç›®æ¨™ï¼š</strong>ä½¿ç”¨é¨å£«çš„èµ°æ³•èµ°éæ•´å€‹æ£‹ç›¤ï¼Œæ¯æ ¼åªèƒ½èµ°ä¸€æ¬¡ï¼Œå®Œæˆå…¨åœ–æŒ‘æˆ°ï¼</p>
    <p><strong>é¨å£«èµ°æ³•ï¼š</strong>å¯å‘å‰å¾Œå·¦å³è·³å…©æ ¼å†è½‰å½ä¸€æ ¼ï¼ˆL å½¢ï¼‰ï¼Œå…±å…«ç¨®å¯èƒ½ã€‚</p>
    <p><strong>ç©æ³•èªªæ˜ï¼š</strong></p>
    <ul>
      <li>é»ä»»æ„æ ¼å­é–‹å§‹ç¬¬ä¸€æ­¥</li>
      <li>åªèƒ½é»æ“Šåˆæ³•ä½ç½®ï¼ˆæœƒé¡¯ç¤ºè—è‰²æç¤ºï¼‰</li>
      <li>æ¯ä¸€æ­¥æœƒé¡¯ç¤ºä½ èµ°åˆ°çš„é †åº</li>
      <li>ç„¡æ³•ç§»å‹•æ™‚æœƒé¡¯ç¤ºã€ŒæŒ‘æˆ°å¤±æ•—ã€</li>
      <li>èµ°æ»¿æ‰€æœ‰æ ¼å­å‰‡é¡¯ç¤ºã€ŒæŒ‘æˆ°æˆåŠŸã€</li>
    </ul>
    <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
  </div>

  <div id="controls">
    <label for="size">æ£‹ç›¤å¤§å°ï¼š</label>
    <select id="size" onchange="resetGame()">
      <option value="5">5x5</option>
      <option value="6">6x6</option>
      <option value="7">7x7</option>
      <option value="8">8x8</option>
    </select>
    <button onclick="undoMove()">è¿”å›ä¸Šä¸€æ­¥</button>
    <button onclick="resetGame()">é‡æ–°å†ç©ä¸€æ¬¡</button>
  </div>

  <div id="board"></div>
  <div id="message"></div>

  <script>
    const board = document.getElementById('board');
    const message = document.getElementById('message');
    const sizeSelect = document.getElementById('size');
    const controls = document.getElementById('controls');
    const intro = document.getElementById('intro');

    let size = parseInt(sizeSelect.value);
    let step, knightPos, visited, history;

    function startGame() {
      intro.style.display = 'none';
      controls.style.display = 'block';
      board.style.display = 'grid';
      message.style.display = 'block';
      resetGame();
    }

    function isInside(x, y) {
      return x >= 0 && x < size && y >= 0 && y < size;
    }

    function getKnightMoves(x, y) {
      const moves = [
        [1, 2], [2, 1], [-1, 2], [-2, 1],
        [1, -2], [2, -1], [-1, -2], [-2, -1]
      ];
      return moves
        .map(([dx, dy]) => [x + dx, y + dy])
        .filter(([nx, ny]) => isInside(nx, ny) && !visited[nx][ny]);
    }

    function clearAvailable() {
      document.querySelectorAll('.cell').forEach(cell => {
        cell.classList.remove('available');
      });
    }

    function clearLastMove() {
      document.querySelectorAll('.cell').forEach(cell => {
        cell.classList.remove('last-move');
      });
    }

    function showAvailableMoves(x, y) {
      clearAvailable();
      const moves = getKnightMoves(x, y);
      moves.forEach(([nx, ny]) => {
        const cell = document.querySelector(`[data-x="${nx}"][data-y="${ny}"]`);
        cell.classList.add('available');
      });

      if (moves.length === 0) {
        if (step <= size * size) {
          setTimeout(() => message.textContent = "éŠæˆ²çµæŸï¼šç„¡æ³•ç¹¼çºŒç§»å‹•ï¼ŒæŒ‘æˆ°å¤±æ•—ï¼", 100);
        }
      }
    }

    function handleClick(e) {
      const cell = e.target;
      const x = +cell.dataset.x;
      const y = +cell.dataset.y;
      if (knightPos === null || cell.classList.contains('available')) {
        clearLastMove();
        visited[x][y] = true;
        cell.textContent = step;
        cell.classList.add('visited', 'last-move');
        history.push({ x, y, step });
        clearAvailable();
        knightPos = [x, y];
        step++;
        if (step > size * size) {
          message.textContent = "æ­å–œå®ŒæˆæŒ‘æˆ°ï¼";
        } else {
          showAvailableMoves(x, y);
        }
      }
    }

    function undoMove() {
      if (history.length === 0) return;
      clearLastMove();
      const last = history.pop();
      visited[last.x][last.y] = false;
      const cell = document.querySelector(`[data-x="${last.x}"][data-y="${last.y}"]`);
      cell.textContent = '';
      cell.classList.remove('visited', 'last-move');
      step = last.step;
      knightPos = history.length > 0 ? [history[history.length - 1].x, history[history.length - 1].y] : null;
      if (knightPos) {
        const lastCell = document.querySelector(`[data-x="${knightPos[0]}"][data-y="${knightPos[1]}"]`);
        lastCell.classList.add('last-move');
      }
      message.textContent = '';
      if (knightPos) {
        showAvailableMoves(knightPos[0], knightPos[1]);
      } else {
        clearAvailable();
      }
    }

    function resetGame() {
      size = parseInt(sizeSelect.value);
      board.innerHTML = '';
      board.style.gridTemplateColumns = `repeat(${size}, 60px)`;
      board.style.gridTemplateRows = `repeat(${size}, 60px)`;
      step = 1;
      knightPos = null;
      history = [];
      visited = Array(size).fill(null).map(() => Array(size).fill(false));
      message.textContent = '';
      for (let x = 0; x < size; x++) {
        for (let y = 0; y < size; y++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          if ((x + y) % 2 === 0) {
            cell.style.backgroundColor = '#f0d9b5';
          } else {
            cell.style.backgroundColor = '#b58863';
          }
          cell.dataset.x = x;
          cell.dataset.y = y;
          cell.addEventListener('click', handleClick);
          board.appendChild(cell);
        }
      }
    }
  </script>
</body>
</html>
